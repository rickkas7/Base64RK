<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Base64RK: Base64RK - Base64 Encoder/Decoder for Particle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Base64RK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Base64RK - <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> Encoder/Decoder for Particle </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> Useful for transmitting binary data in places where only text strings are allowed. On the Particle platform, functions, publish, and subscribe need encoding of binary data.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Base64">https://en.wikipedia.org/wiki/Base64</a></li>
<li><a href="https://tools.ietf.org/html/rfc4648">https://tools.ietf.org/html/rfc4648</a></li>
</ul>
<h1>API</h1>
<h2>encode</h2>
<p>Encode binary data to <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a></p>
<div class="fragment"><div class="line">static bool encode(const uint8_t *src, size_t srcLen, char *dst, size_t &amp;dstLen, bool nullTerminate, int lineBreakAt = -1);</div>
</div><!-- fragment --><ul>
<li>src Pointer to the binary data to encode.</li>
<li>srcLen Length of the binary data to encode in bytes.</li>
<li>dst Pointer to the buffer to hold the character string. See getEncodedSize() for information on how large of a buffer you need.</li>
<li>dstLen On input, the length of the buffer pointed to by dst. On successful return, the number of bytes of text data.</li>
<li>nullTerminate true to add a null terminator, false to not. Note that the length in dstLen does NOT include the null terminator if included.</li>
<li>lineBreakAt Pass -1 to not add line breaks, or the column to add line breaks, which must be a multiple of 4 and is typically 76, sometimes 64. Default is to not add line breaks.</li>
<li>Returns true on success or false on failure (buffer too small, for example)</li>
</ul>
<p>This method does not break the data into lines. The intended use case of this is things like Particle.publish and the line breaks are not helpful and just use up extra bytes.</p>
<p>This method does not allocate memory. It is MT safe.</p>
<hr  />
<h2>getEncodedSize</h2>
<p>Determine the buffer size for the encoded <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> data</p>
<div class="fragment"><div class="line">static size_t getEncodedSize(size_t srcLen, bool nullTerminate, int lineBreakAt = -1);</div>
</div><!-- fragment --><ul>
<li>srcLen The size of the data in bytes</li>
<li>nullTerminate true if you will be adding a null terminator or false if not</li>
<li>lineBreakAt Pass -1 to not add line breaks, or the column to add line breaks, which must be a multiple of 4 and is typically 76, sometimes 64. Default is to not add line breaks.</li>
</ul>
<p>The size is (srcLen + 2) / 3 * 4.</p>
<p>This method does not allocate memory. It is MT safe.</p>
<hr  />
<h2>encodeToString</h2>
<p>Encode binary data and return it as a String object.</p>
<div class="fragment"><div class="line">static String encodeToString(const uint8_t *src, size_t srcLen, int lineBreakAt = -1);</div>
</div><!-- fragment --><ul>
<li>src Pointer to the binary data to encode.</li>
<li>srcLen Length of the binary data to encode in bytes.</li>
<li>lineBreakAt Pass -1 to not add line breaks, or the column to add line breaks, which must be a multiple of 4 and is typically 76, sometimes 64. Default is to not add line breaks.</li>
<li>Returns A String object containing <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> data</li>
</ul>
<p>This method does not break the data into lines. The intended use case of this is things like Particle.publish and the line breaks are not helpful and just use up extra bytes.</p>
<p>This is relatively efficient (the buffer is only allocated once using reserve) but using the other encode() method does not require a memory allocation and is more efficient.</p>
<p>This method is MT safe.</p>
<hr  />
 <h2>encodeToString</h2>
<p>Encode binary data and store the data in a String object.</p>
<div class="fragment"><div class="line">static void encodeToString(const uint8_t *src, size_t srcLen, String &amp;output);</div>
</div><!-- fragment --><ul>
<li>src Pointer to the binary data to encode.</li>
<li>srcLen Length of the binary data to encode in bytes.</li>
<li>output Filled in with the <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> encoded data</li>
</ul>
<p>This method does not break the data into lines. The intended use case of this is things like Particle.publish and the line breaks are not helpful and just use up extra bytes.</p>
<p>This is relatively efficient (the buffer is only allocated once using reserve) but using the other encode() method does not require a memory allocation and is more efficient.</p>
<p>This method is MT safe. Added in version 0.0.2.</p>
<hr  />
<h2>decode (c-string)</h2>
<p>Decode <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> encoded data back to binary data from a c-string</p>
<div class="fragment"><div class="line">static bool decode(const char *src, uint8_t *dst, size_t &amp;dstLen);</div>
</div><!-- fragment --><ul>
<li>src Pointer to the source string. You can directly pass a String object if desired.</li>
<li>dst Pointer to a buffer to store te binary data in</li>
<li>dstLen On input, the size of the buffer pointed to by dst. On successful return, the number of actual bytes.</li>
<li>Returns true on a successful decode or false on error (invalid input or dstLen too small)</li>
</ul>
<p>The input src must not contain line breaks (CRLF). The intended use case of this is things like Particle.publish and the line breaks are not helpful and just use up extra bytes.</p>
<p>This method does not allocate memory. It is MT safe.</p>
<hr  />
<h2>decode (buffer and length)</h2>
<p>Decode <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> encoded data back to binary data from a buffer and length</p>
<div class="fragment"><div class="line">static bool decode(const char *src, size_t srcLen, uint8_t *dst, size_t &amp;dstLen);</div>
</div><!-- fragment --><ul>
<li>src Pointer to the source string. It does not need to be null terminated.</li>
<li>srcLen The length of the source string in bytes</li>
<li>dst Pointer to a buffer to store te binary data in</li>
<li>dstLen On input, the size of the buffer pointed to by dst. On successful return, the number of actual bytes.</li>
<li>Returns true on a successful decode or false on error (invalid input or dstLen too small)</li>
</ul>
<p>The input src must not contain line breaks (CRLF). The intended use case of this is things like Particle.publish and the line breaks are not helpful and just use up extra bytes.</p>
<p>This method does not allocate memory. It is MT safe.</p>
<hr  />
<h2>getMaxDecodedSize</h2>
<p>Get the maximum size of the decoded data, given <a class="el" href="class_base64.html" title="Class for Base64 encoding and decoding.">Base64</a> encoded string of srcLen</p>
<div class="fragment"><div class="line">static size_t getMaxDecodedSize(size_t srcLen);</div>
</div><!-- fragment --><p>This is ((srcLen + 3) / 4) * 3. The actual data may be smaller than this if it's not a multiple of 3 bytes and padding is inserted. The actual length will be returned in dstLen for decode.</p>
<p>This method does not allocate memory. It is MT safe.</p>
<h1>Examples</h1>
<h2>examples/1-tester-Base64</h2>
<p>This example uses Particle functions and publish to test the various methods.</p>
<p>For example, given the code running on device test2:</p>
<div class="fragment"><div class="line">particle call test2 text &quot;hello world&quot;</div>
</div><!-- fragment --><p>The following will appear on debug serial and published:</p>
<div class="fragment"><div class="line">text-&gt;base64 aGVsbG8gd29ybGQ=</div>
</div><!-- fragment --><p>You can then decode this to hex:</p>
<div class="fragment"><div class="line">particle call test2 base64 aGVsbG8gd29ybGQ=</div>
</div><!-- fragment --><p>which generates:</p>
<div class="fragment"><div class="line">base64-&gt;hex 68656c6c6f20776f726c64</div>
</div><!-- fragment --><p>You can also convert hex back to base64:</p>
<div class="fragment"><div class="line">particle call test2 hex &quot;68656c6c6f20776f726c64&quot;</div>
</div><!-- fragment --><div class="fragment"><div class="line">hex-&gt;base64 aGVsbG8gd29ybGQ=</div>
</div><!-- fragment --><h2>examples/2-unittest-Base64</h2>
<p>This example runs pre-generated sample data through the parser and decoder to make sure they work properly.</p>
<h1>Test Code</h1>
<p>There is also code in the test directory, for off-device testing.</p>
<h2>generate-test-data</h2>
<p>This is the node.js tool that generated the test data used in the unit tests (both on-device and off-device).</p>
<h2>unit-test</h2>
<p>The unit-test is designed to run on a standard gcc environment, such as Mac or Linux, or cygwin. It encodes and decodes a variety of data samples and makes sure they match the expected data.</p>
<p>Data from size 0 to 16 bytes is tested, as well as other sizes up to 512 bytes, to make sure a variety of padding circumstances are tested, as well as a large number of bit combinations.</p>
<p>Particularly useful is running under Linux with <a href="http://valgrind.org/">valgrind</a> installed. The <code>make check</code> target runs the unit-test program under valgrind. The tool detects common memory errors including if the code:</p>
<ul>
<li>Accesses memory it shouldn't (areas not yet allocated, areas that have been freed, areas past the end of heap blocks, inaccessible areas of the stack).</li>
<li>Uses uninitialized values in dangerous ways.</li>
<li>Leaks memory.</li>
<li>Does bad frees of heap blocks (double frees, mismatched frees).</li>
<li>Passes overlapping source and destination memory blocks to memcpy() and related functions.</li>
</ul>
<h1>Version history</h1>
<h2>0.0.2 (2024-03-29)</h2>
<ul>
<li>Added an encodeToString overload that encodes to a String object instead of returning it.</li>
<li>Added support for adding line breaks when decoding and supporting them when decoding. </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
